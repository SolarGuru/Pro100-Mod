require("default");local v0=77 -27 ;local v1=1396 -(383 + 863) ;local v2=1222 -(196 + 126) ;local v3=0.01 -0 ;local v4=982 -(18 + 964) ;local v5={};local v6={};local v7={};local v8={};local v9={};local v10={};local v11={};local v12={};function GetModifiedDamage(v13,v14,v15)local v16=0 -0 ;local v17;local v18;local v19;local v20;while true do if (v16==(1 + 0)) then if v13.currWeapon then v10[v13.id]={v13.currWeapon.damageMin,v13.currWeapon.damageMax};v11[v13.id]=v13.currWeapon.actions;local v427=v13.currWeapon.prototype.typeId;if ((v427==WeaponType.Bow) or (v427==WeaponType.Crossbow) or (v427==WeaponType.Dagger)) then v12[v13.id]=true;else v12[v13.id]=false;end else local v428=0 + 0 ;while true do if (v428==0) then v11[v13.id]=v18;if (v10[v13.id]==nil) then v10[v13.id]={v15,v15};elseif (v10[v13.id][1 + 0 ]==nil) then v10[v13.id][1]=v15;elseif (v10[v13.id][740 -(542 + 196) ]==nil) then v10[v13.id][3 -1 ]=v15;elseif ((v15~=v10[v13.id][1 + 0 ]) and (v15~=v10[v13.id][2 + 0 ])) then if (v15>v10[v13.id][1 + 1 ]) then local v554=0 -0 ;while true do if ((0 -0)==v554) then if (v10[v13.id][1]==v9[v13.id]) then v10[v13.id][1552 -(1126 + 425) ]=v10[v13.id][407 -(118 + 287) ];end v10[v13.id][2]=v15;break;end end elseif (v15<v10[v13.id][3 -2 ]) then local v557=1121 -(118 + 1003) ;while true do if (v557==(0 -0)) then if (v10[v13.id][1]==v9[v13.id]) then v10[v13.id][2]=v10[v13.id][378 -(142 + 235) ];end v10[v13.id][4 -3 ]=v15;break;end end elseif ((v10[v13.id][1 + 0 ]==v9[v13.id]) or (v10[v13.id][978 -(553 + 424) ]==(0 -0))) then v10[v13.id][1 + 0 ]=v15;elseif ((v10[v13.id][2 + 0 ]==v9[v13.id]) or (v10[v13.id][1]==(0 + 0))) then v10[v13.id][2]=v15;end end break;end end end if (v12[v13.id] and (v12[v13.id]==true)) then return math.max(0 + 0 ,v15);end v16=2 + 0 ;end if (v16==(8 -4)) then v20=math.max(0 -0 ,((v20-v15) * v18)/(223 -123) );return math.max(0 + 0 ,(v15 + v17 + v19) -v20 );end if ((9 -7)==v16) then if v11[v13.id] then v18=v11[v13.id];end v19=v13:spellEffect(SpellType.Strengthen);v16=3;end if ((756 -(239 + 514))==v16) then v20=v13:spellEffect(SpellType.Weaken);v19=math.max(0 + 0 ,((v19-v15) * v18)/(1429 -(797 + 532)) );v16=3 + 1 ;end if (v16==(0 + 0)) then v17=GetStrength(v14) -(58 -33) ;v18=1242 -(373 + 829) ;v16=732 -(476 + 255) ;end end end function GetModifiedDamageOnClient(v21,v22,v23)local v24=UnitClientStats(v21);local v25=UnitClient(v22);return GetModifiedDamage(v25,v24,v23);end function GetModifiedDamageOnServer(v26,v27,v28)local v29=1130 -(369 + 761) ;local v30;local v31;while true do if (0==v29) then v30=UnitServerStats(v26);v31=UnitServer(v27);v29=1 + 0 ;end if (v29==1) then return GetModifiedDamage(v31,v30,v28);end end end function CalcBaseHealth(v32)return 181 -81 ;end function CalcBaseMana(v33)return 189 -89 ;end function GetModifiedHealth(v34,v35,v36)return v36;end function RegenerateHp(v37,v38,v39)local v40=238 -(64 + 174) ;local v41;local v42;local v43;local v44;local v45;local v46;local v47;local v48;local v49;local v50;local v51;while true do if (v40==(1 + 3)) then v42:heal(v37,v51);if (v45.curr>v45.max) then v45.curr=v45.max;end v7[v43.id]=v45.curr;return v44;end if (v40==(0 -0)) then v41=UnitServerCommonStats(v37);v42=UnitServerStats(v38);v43=UnitServer(v39);v44=false;v40=1;end if (v40==(338 -(144 + 192))) then v47=math.max(216 -(42 + 174) ,((v43:spellEffect(SpellType.Stench) -GetUnitArmor(v43,v41,DamageType.General))/(8 + 2))/15 );v48=RecalcDamageModifier(v42,BodyPartType.Body);v49=0 + 0 ;if (v6[v43.id]<=(0 + 0)) then v49=v3 * (1604 -(363 + 1141)) ;v44=true;end v40=1583 -(1183 + 397) ;end if (v40==3) then v50=((v45.regen * (304 -204)) + v42:perkModifier(PerkType.Vitality))/(11 + 4) ;v51=((v48 * (v49 + v50)) + v46) -v47 ;v51=math.min(v45.max-v45.curr ,v51);if (v51<0) then local v432=0 + 0 ;while true do if (v432==(1975 -(1913 + 62))) then for v509=0,4 + 1  do local v510=0 -0 ;local v511;while true do if (v510==(1933 -(565 + 1368))) then v511=v42:hitLocation(v509);if (v511.hp>=v511.maxHp) then v511.hp=math.max(0 -0 ,v511.maxHp-0.001 );end break;end end end if ((v45.curr + v51)<(1662 -(1477 + 184))) then v51=math.max(0 -0 ,(1 + 0) -v45.curr );end break;end end end v40=860 -(564 + 292) ;end if (v40==1) then v45=v41.hp;for v398=0 -0 ,15 -10  do local v399=0;local v400;while true do if (v399==(304 -(244 + 60))) then v400=v42:hitLocation(v398);v400.hp=math.max(0 + 0 ,v400.hp);break;end end end if v7[v43.id] then if (v7[v43.id]>v45.curr) then local v472=476 -(41 + 435) ;local v473;local v474;while true do if (v472==(1002 -(938 + 63))) then v474=v473/2 ;v41.mp.curr=math.max(0.1,v41.mp.curr-v474 );v472=2;end if (v472==(0 + 0)) then v473=v7[v43.id] -v45.curr ;v6[v43.id]=v1;v472=1;end if (v472==2) then v8[v43.id]=math.max(1125.1 -(936 + 189) ,v8[v43.id] -v474 );break;end end elseif (v7[v43.id]<v45.curr) then local v512=0;local v513;while true do if (v512==(1 + 0)) then v42:heal(v37,v513);break;end if (v512==0) then v513=v45.curr-v7[v43.id] ;v513=math.max(1613 -(1565 + 48) ,(v513 * (618 + 381)) -CalcArmor(v43,DamageType.General) );v512=1;end end end end v46=math.max(1138 -(782 + 356) ,((v43:spellEffect(SpellType.Regeneration) -GetUnitArmor(v43,v41,DamageType.General))/(277 -(176 + 91)))/(39 -24) );v40=2 -0 ;end end end function RegenerateMp(v52,v53,v54,v55)local v56=UnitServerCommonStats(v52);local v57=UnitServerStats(v53);local v58=UnitServer(v54);local v59=false;local v60=v56.mp;if (v8[v58.id] and (v8[v58.id]>v60.curr)) then local v323=1092 -(975 + 117) ;local v324;while true do if (v323==(1875 -(157 + 1718))) then v324=v8[v58.id] -v60.curr ;v60.curr=math.max(0.1,v60.curr-(v324 * (812 + 188)) );v323=3 -2 ;end if (v323==(3 -2)) then v6[v58.id]=v1;break;end end end if (v60.curr<v60.max) then local v325=1018 -(697 + 321) ;local v326;local v327;local v328;local v329;while true do if (v325==(7 -4)) then v56:regenMp(v326 * v328 * v329 * v327 );v59=true;break;end if (v325==(0 -0)) then v326=v60.regen/(34 -19) ;if (v6[v58.id]>(0 + 0)) then if (v58.isMoving or IsMage(v58)) then v326=0 -0 ;else v326=v326/(13 -8) ;end end v325=1228 -(322 + 905) ;end if (v325==(613 -(602 + 9))) then if  not v58.isAggressive then v328=(1190 -(449 + 740)) + (v57:perkModifier(PerkType.Spirit) * (872.01 -(826 + 46))) ;end v329=RecalcDamageModifier(v57,BodyPartType.Body);v325=950 -(245 + 702) ;end if (v325==1) then v327=(3 -2) -(v57:perkModifier(PerkType.Mana) * 0.01) ;v328=1 + 0 ;v325=1900 -(260 + 1638) ;end end else v60.curr=v60.max;end if v55 then local v332=(441 -(382 + 58)) + ((0.02 -0) * (GetDexterity(v57) -(21 + 4))) ;local v333=82 -42 ;if v11[v58.id] then v333=v11[v58.id];end local v334=1 -(v57:perkModifier(PerkType.Mana) * (0.01 -0)) ;local v335=((v333 * v334)/v332)/(1215 -(902 + 303)) ;local v336=0.5;if ((v58.isPlayer and v58.isAggressive) or ( not v58.isPlayer and (v60.curr>((144 -78) + v335)) and  not IsMage(v58))) then v336=1;end v60.curr=math.max(0.1 -0 ,v60.curr-(v335 * v336) );end v8[v58.id]=v60.curr;return v59;end function RegenerateHpAndMp(v63,v64,v65,v66)local v67=UnitServerCommonStats(v63);local v68=UnitServerStats(v64);local v69=UnitServer(v65);if (v69.pose==UnitPoseType.Rest) then v66=false;end if (v6[v69.id]==nil) then v6[v69.id]=0 + 0 ;end local v70=v6[v69.id];local v71=false;if (v70>v1) then v70=v1;v71=true;end if ((v69.isMoving and (v69.pose==UnitPoseType.Run)) or (v66 and  not v69.isMoving and  not v69.isPlayer and (v70>(v1/5)))) then v70=math.min(v1,v70 + 10 );elseif (v70>0) then v70=v70-1 ;end v6[v69.id]=v70;RecalcSight(v69,v68);v68:percept(SenseType.Smell).curr=RecalcDamageModifier(v68,BodyPartType.Head) * (1790 -(1121 + 569)) ;v68:percept(SenseType.Tracking).curr=RecalcDamageModifier(v68,BodyPartType.Leg) * 100 ;v68:sense(SenseType.Smell).curr=v67.mp.curr;if v69.isPlayer then CalcPlayersCount(v69);end local v77=RegenerateHp(v63,v64,v65);local v78=RegenerateMp(v63,v64,v65,v71);return v77 or v78 or true ;end function CalcRunningManaCost(v79,v80,v81)local v82=214 -(22 + 192) ;local v83;local v84;local v85;local v86;local v87;local v88;while true do if (v82==(685 -(483 + 200))) then v87=(1488 -(1404 + 59))/v83.dexterity.curr ;v88=1 -(v83:perkModifier(PerkType.Mana) * (0.01 -0)) ;break;end if (v82==(0 -0)) then v83=UnitServerStats(v79);v84=UnitServer(v80);v82=1;end if (v82==(766 -(468 + 297))) then v85=UnitServerCommonStats(v81);v86=v85.mp;v82=2;end end end function GetSkillPrice(v89)return 25 * ((564 -(334 + 228))^(v89/(16 -11))) ;end function GetSkillPriceDiff(v90,v91)return math.floor(GetSkillPrice(v91) -GetSkillPrice(v90) );end function GetPerkPrice(v92,v93)local v94=0 -0 ;local v95;local v96;local v97;local v98;local v99;while true do if (v94==(2 -0)) then for v402=0 + 0 ,35 do v98=v98 + v95.perks:value(v402) ;end v97=v97 * ((240 -(141 + 95))^v98) ;v94=3 + 0 ;end if (v94==(9 -5)) then if ((v97/v99)<(9 -5)) then if (v99<=(3 + 7)) then return math.ceil(v97);else v99=v99 * 0.1 ;end end return math.floor((v97/v99) + 0.5 ) * v99 ;end if (0==v94) then v95=UnitServerStats(v92);v96=PerksDatabase.PerksTableRecord(v93);v94=2 -1 ;end if (v94==(3 + 0)) then if (v97>(520724895 + 479275105)) then v97=2055542158 -1055542158 ;end v99=(7 + 3)^math.floor(math.log10(v97)) ;v94=4;end if ((1118 -(741 + 376))==v94) then v97=GetSkillPriceDiff(v96.cost-(3 + 7) ,v96.cost);v98=0;v94=2;end end end function GetMaxEncumbrance(v100)local v101=v100.strength.curr * (1589 -(280 + 1297)) ;local v102=0;if (v100:perkModifier(PerkType.Lift)~=0) then local v339=v100.perks:value(PerkType.Lift);if (v339==(766 -(574 + 191))) then v102=40;elseif (v339==(2 + 0)) then v102=200 -120 ;elseif (v339==3) then v102=120;end end return v101 + v102 ;end function RecalcDamageModifier(v103,v104)local v105=1 + 0 ;for v312=849 -(254 + 595) ,131 -(55 + 71)  do local v313=v103:hitLocation(v312);if ((v313.state~=ArmorLayerState.NotUsed) and (v313.type==v104) and (v313.hp<v313.maxHp)) then v105=math.min(v105,v313.hp/v313.maxHp );end end if (v105<=(0.33 -0)) then return 1790.5 -(573 + 1217) ;elseif (v105<=(0.66 -0)) then return 0.75 + 0 ;else return 1 -0 ;end end function SetDefaultStats(v106,v107)local v108=0;while true do if ((941 -(714 + 225))==v108) then for v403=0,6 do v107:absorbtion(v403).curr=v107:absorbtion(v403).base;end break;end if (v108==0) then v106.strength.curr=v106.strength.base;v106.dexterity.curr=v106.dexterity.base;v108=2 -1 ;end if (v108==(1 -0)) then v106.intelligence.curr=v106.intelligence.base;for v406=0 + 0 ,3 -0  do local v407=806 -(118 + 688) ;while true do if (v407==(48 -(25 + 23))) then v106:sense(v406).curr=v106:sense(v406).base;v106:percept(v406).curr=v106:percept(v406).base;break;end end end v108=1 + 1 ;end end end function ApplyAttackParams(v109,v110,v111)local v112=1886 -(927 + 959) ;local v113;local v114;local v115;local v116;local v117;local v118;local v119;local v120;local v121;local v122;local v123;local v124;local v125;local v126;local v127;while true do if (0==v112) then v113=0;if ((v111.weaponType==WeaponType.Bow) or (v111.weaponType==WeaponType.Crossbow)) then if (v10[v109.id] and v10[v109.id][3 -2 ]) then v113=math.max(732 -(16 + 716) ,v109:spellEffect(SpellType.EagleSight) -v10[v109.id][1 -0 ] );end end v114=0;if v109.isPlayer then if (OverloadMod(v109,v110)>(98 -(11 + 86))) then v114=0.5 * v0 ;end end v112=1;end if (v112==(12 -7)) then v125=285 -(175 + 110) ;v126=(((v113-v115) -v114) -v117) -v119 ;v127=((((v115-v114) -v117) -v116) -v124) + v125 ;v111.attack=math.max(0 -0 ,v111.attack + v126 );v112=6;end if ((19 -15)==v112) then v123=((v121 * v122)/v120)/5 ;if (( not v109.isPlayer and (v118<((1862 -(503 + 1293)) + v123))) or  not v109.isAggressive or IsMage(v109)) then v119=0.25 * v0 ;end v124=0 -0 ;if (v109.pose==UnitPoseType.Crawl) then v124=(0.25 + 0) * v0 ;elseif ((v109.pose==UnitPoseType.Lay) or (v109.pose==UnitPoseType.Rest)) then v124=(1061.5 -(810 + 251)) * v0 ;end v112=5;end if (v112==2) then v118=0 + 0 ;if v110.isServer then v118=v110:sense(SenseType.Smell).curr;else v118=v110.senses:value(SenseType.Smell);end if (v118<(((1 + 0)/(3 + 0)) * 100)) then v117=(533.25 -(43 + 490)) * v0 ;elseif (v118<(((735 -(711 + 22))/3) * (386 -286))) then v117=0.125 * v0 ;end v119=0;v112=862 -(240 + 619) ;end if ((1 + 0)==v112) then v115=0;v116=0;if v110.isServer then v116=v0 * ((1 -0) -RecalcDamageModifier(v110,BodyPartType.Leg)) ;elseif (v110.percepts:value(SenseType.Tracking)>(1 + 0)) then v116=(1 -(v110.percepts:value(SenseType.Tracking)/(1844 -(1344 + 400)))) * v0 ;end v117=405 -(255 + 150) ;v112=2 + 0 ;end if (v112==(2 + 1)) then v120=(4 -3) + (0.02 * (GetDexterity(v110) -(80 -55))) ;v121=1809 -(404 + 1335) ;if v109.currWeapon then v121=v109.currWeapon.actions;elseif v109.nawActions then v121=v109.nawActions;end v122=(407 -(183 + 223)) -(v110:perkModifier(PerkType.Mana) * 0.01) ;v112=4 -0 ;end if (v112==(4 + 2)) then v111.defense=math.max(0,v111.defense + v127 );break;end end end function CalcAttackParamsOnServer(v128,v129,v130,v131)local v132=0 + 0 ;local v133;local v134;local v135;while true do if (v132==(339 -(10 + 327))) then ApplyAttackParams(v133,v134,v135);break;end if (v132==1) then v135=AttackParams(v130);v6[v133.id]=v1 + 1 ;v132=2 + 0 ;end if ((338 -(118 + 220))==v132) then v133=UnitServer(v129);v134=UnitServerStats(v128);v132=1 + 0 ;end end end function CalcAttackParamsOnClient(v136,v137,v138,v139)local v140=449 -(108 + 341) ;local v141;local v142;local v143;while true do if (v140==1) then v143=AttackParams(v138);ApplyAttackParams(v141,v142,v143);break;end if (v140==(0 + 0)) then v141=UnitServer(v137);v142=UnitClientStats(v136);v140=4 -3 ;end end end function GetManaBonusOnServer(v144)local v145=1493 -(711 + 782) ;local v146;local v147;local v148;local v149;local v150;local v151;while true do if (v145==(1 -0)) then v148=(470 -(270 + 199)) -(v146:perkModifier(PerkType.Mana) * (0.01 + 0)) ;v149=1;v145=2;end if (v145==(1822 -(580 + 1239))) then v151=v146.perks:value(PerkType.Mana);if (v151==(2 -1)) then v148=0.9;elseif (v151==2) then v148=0.8 + 0 ;elseif (v151==(1 + 2)) then v148=0.7 + 0 ;end v145=9 -5 ;end if (v145==(2 + 0)) then v150=1168 -(645 + 522) ;if (v146.currEncumbrance>v146.maxEncumbrance) then v150=1792 -(1010 + 780) ;end v145=3;end if (v145==(0 + 0)) then v146=UnitServerStats(v144);v147=GetManaBonus(v146.intelligence.curr);v145=4 -3 ;end if (v145==(11 -7)) then return ((v147 * v148)/v149) * v150 ;end end end function GetManaBonusOnClient(v152)local v153=1836 -(1045 + 791) ;local v154;local v155;local v156;while true do if (1==v153) then v156=v154.perks:value(PerkType.Mana);if (v156==1) then v155=0.9 -0 ;elseif (v156==(2 -0)) then v155=0.8;elseif (v156==(508 -(351 + 154))) then v155=0.7;end v153=1576 -(1281 + 293) ;end if (v153==(266 -(28 + 238))) then v154=UnitClientStats(v152);v155=1;v153=1;end if (v153==(4 -2)) then return GetManaBonus(v154.intelligence) * v155 ;end end end function GetExpMultiplier(v157)return v157/25 ;end function Round(v158)return math.floor(v158 + 0.5 );end function GetStrength(v159)if v159.isServer then return v159.strength.curr;else return v159.strength;end end function GetDexterity(v160)if v160.isServer then return v160.dexterity.curr;else return v160.dexterity;end end function GetIntelligence(v161)if v161.isServer then return v161.intelligence.curr;else return v161.intelligence;end end function RecalcSight(v162,v163)local v164=0;local v165;local v166;local v167;local v168;local v169;local v170;local v171;while true do if (v164==0) then v165=v163:sense(SenseType.Sight).base;v166=0;v164=1;end if (v164==(1561 -(1381 + 178))) then v168=(v165 * math.max(0,v162:spellEffect(SpellType.DetectLife) -v166 ))/(94 + 6) ;v169=RecalcDamageModifier(v163,BodyPartType.Head);v164=3 + 0 ;end if (v164==(2 + 2)) then if v162.isPlayer then local v437=0 -0 ;while true do if (v437==0) then v163.visionArc=0;v163:sense(SenseType.Sight).curr=v171;break;end end elseif (v170>=(v1/(3 + 2))) then if (v163.visionArc>(470 -(381 + 89))) then v163.visionArc=v163.visionArc-((0.5 + 0)/v1) ;v163:sense(SenseType.Sight).curr=v171 * ((1 + 0) -((v163.visionArc * 2 * (8 -3))/v165)) ;v163:sense(SenseType.Hearing).curr=v163:sense(SenseType.Hearing).base * ((1157 -(1074 + 82)) -v163.visionArc) ;else local v517=0 -0 ;while true do if (v517==(1785 -(214 + 1570))) then v163:sense(SenseType.Hearing).curr=v163:sense(SenseType.Hearing).base;break;end if (v517==(1455 -(990 + 465))) then v163.visionArc=0 + 0 ;v163:sense(SenseType.Sight).curr=v171;v517=1;end end end elseif (v163.visionArc<(0.5 + 0)) then local v518=0;while true do if (v518==(0 + 0)) then v163.visionArc=v163.visionArc + ((0.5 -0)/v2) ;v163:sense(SenseType.Sight).curr=v171 * (1 -((v163.visionArc * (1728 -(1668 + 58)) * (631 -(512 + 114)))/v165)) ;v518=2 -1 ;end if (v518==(1 -0)) then v163:sense(SenseType.Hearing).curr=v163:sense(SenseType.Hearing).base * (1 -v163.visionArc) ;break;end end else local v519=0;while true do if (v519==(0 -0)) then v163.visionArc=0.5 + 0 ;v163:sense(SenseType.Sight).curr=v171 * ((1 + 0) -((5 + 0)/v165)) ;v519=3 -2 ;end if (v519==(1995 -(109 + 1885))) then v163:sense(SenseType.Hearing).curr=(1469.5 -(1269 + 200)) * v163:sense(SenseType.Hearing).base ;break;end end end v163:sense(SenseType.SenseLife).curr=v163:sense(SenseType.SenseLife).base + v168 ;break;end if (v164==1) then if v162:armor(ArmorType.Helm) then v166=v162:armor(ArmorType.Helm).absorbtions:value(DamageType.General);elseif v9[v162.id] then v166=v9[v162.id];end v167=(v165 * math.max(0,v162:spellEffect(SpellType.EagleSight) -v166 ))/(191 -91) ;v164=817 -(98 + 717) ;end if ((829 -(802 + 24))==v164) then v170=v6[v162.id];v171=(v165 + v167) * v169 ;v164=4;end end end function CalcPlayersCount(v172)if PlayerOnMap(v172) then v5[v172.id]=30;end local v173=0 -0 ;for v314,v315 in pairs(v5) do if (v315>0) then local v368=0 -0 ;while true do if (v368==(0 + 0)) then v5[v314]=v5[v314] -(1 + 0) ;v173=v173 + 1 + 0 ;break;end end else v5[v314]=nil;end end end ItemType={Weapon=2652 + 9640 ,Armor=34198 -21905 ,QuickItem=12294,SpellContainer=1245120};function ItemWeight(v174)if v174 then local v341=0;local v342;local v343;while true do if (v341==2) then return v342.weight * v343.weight ;end if (v341==(3 -2)) then v343=ItemsDatabase.MaterialsTable.getRecord(v174.materialId);if (v174.typeId==ItemType.Armor) then v342=ItemsDatabase.ArmorsTable.getRecord(v174.prototypeId);elseif (v174.typeId==ItemType.Weapon) then v342=ItemsDatabase.WeaponsTable.getRecord(v174.prototypeId);elseif (v174.typeId==ItemType.QuickItem) then v342=ItemsDatabase.QuicksTable.getRecord(v174.prototypeId);else return 0;end v341=1 + 1 ;end if (v341==(0 + 0)) then v342=nil;v343=nil;v341=1 + 0 ;end end else return 0 + 0 ;end end function ItemsWeight(v175)local v176=0 + 0 ;for v316=1433 -(797 + 636) ,7 do v176=v176 + ItemWeight(v175:armor(v316)) ;end for v317=0,14 -11  do local v318=1619 -(1427 + 192) ;while true do if (v318==(0 + 0)) then v176=v176 + ItemWeight(v175:weapon(v317)) ;v176=v176 + ItemWeight(v175:quickItem(v317)) ;break;end end end return v176;end function OverloadMod(v177,v178)if v178.isServer then return v178.currEncumbrance/v178.maxEncumbrance ;else return math.max(ItemsWeight(v177),v177.itemsWeight)/v178.encumbrance ;end end SpellEffectBaseType={Id=2 -1 ,Power=2,IsAdditive=3 + 0 };SpellBase={effect={376 -(192 + 134) ,1326 -(316 + 960) ,50,50,47 + 3 ,601 -(83 + 468) ,1856 -(1202 + 604) ,50,83 -33 ,375 -(45 + 280) ,44 + 6 ,50,9 + 41 ,10,50,50,1921 -(340 + 1571) ,20 + 30 ,1772 -(1733 + 39) ,1084 -(125 + 909) ,0,0 -0 ,0,236 -(46 + 190) ,145 -(51 + 44) ,0 + 0 ,776 -(228 + 498) ,0,663 -(174 + 489) ,50,50,1319 -(231 + 1038) ,50,206 -156 ,50,0,0 + 0 ,0 -0 ,0 -0 ,158 -(91 + 67) ,13 + 37 ,1 + 49 },mana={6 + 4 ,10,10,22 -12 ,721 -(530 + 181) ,10,10,23 -13 ,10,3 + 7 ,20 -10 ,10,10,10,10,10,20 -10 ,10,95 -45 ,10,215 -165 ,27 + 23 ,11 + 39 ,50,10,4 + 6 ,7 + 3 ,10,1868 -(673 + 1185) ,32 -22 ,8 + 2 ,8 + 2 ,10,10,19 -9 ,19 -9 ,10,10,10,1857 -(559 + 1288) ,1941 -(609 + 1322) ,10},complex={10,49 -39 ,1 + 9 ,4 + 6 ,5 + 5 ,10,10,18 -8 ,10,6 + 4 ,8 + 2 ,9 + 1 ,10 + 0 ,28 -18 ,10,9 + 1 ,10,4 + 6 ,10 + 0 ,15 -5 ,7 + 3 ,8 + 2 ,10,10,10,1059 -(572 + 477) ,10,10,7 + 3 ,96 -(84 + 2) ,16 -6 ,852 -(497 + 345) ,1 + 9 ,1343 -(605 + 728) ,22 -12 ,36 -26 ,27 -17 ,499 -(457 + 32) ,1412 -(832 + 570) ,10,35 -25 ,10},actions={60,60,856 -(588 + 208) ,1890 -(884 + 916) ,53 + 37 ,743 -(232 + 421) ,60,60,15 + 45 ,60,60,202 -142 ,157 -97 ,3 + 57 ,60,485 -(360 + 65) ,57 + 3 ,314 -(79 + 175) ,189 -69 ,183 -123 ,120,1019 -(503 + 396) ,120,232 -112 ,60,60,60,9 + 51 ,53 + 7 ,182 -122 ,91 -31 ,60,60,1195 -(832 + 303) ,19 + 41 ,3 + 57 ,296 -236 ,158 -98 ,60,60,43 + 17 ,116 -56 },area={1480 -(641 + 839) ,913 -(910 + 3) ,1684 -(1466 + 218) ,4,2 + 2 ,858 -(174 + 680) ,6 -4 ,2,3 -1 ,739 -(396 + 343) ,0,0,1389 -(135 + 1254) ,0 -0 ,1527 -(389 + 1138) ,0 + 0 ,0 + 0 ,0 -0 ,1468 -(157 + 1307) ,0,4,0 -0 ,0,1026 -(834 + 192) ,0 + 0 ,0,304 -(300 + 4) ,0,0,0 -0 ,0 + 0 ,0 + 0 ,0 + 0 ,0 + 0 ,0 + 0 ,1414 -(1001 + 413) ,0,693 -(627 + 66) ,602 -(512 + 90) ,0,0 + 0 ,0},int_mod={"add","add","add","add","add","add","add","add","add","add","add","add","add","mul","add","add","mul","add","mul","add","mul","mul","mul","mul","add","mul","mul","mul","mul","add","add","add","add","add","add","mul","mul","mul","mul","mul","add","add"},combat_rest={false,false,false,false,false,false,false,false,false,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,false,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,false,false},subtype={0 -0 ,1 -0 ,2,0 + 0 ,1 + 0 ,2 + 0 ,0 -0 ,1,2,1993 -(1238 + 755) ,1535 -(709 + 825) ,3 -1 ,868 -(196 + 668) ,7 -3 ,4,3,3,2 + 1 ,3,3 + 3 ,1457 -(28 + 1425) ,1997 -(941 + 1052) ,1517 -(822 + 692) ,2 + 2 ,6 + 0 ,3 + 4 ,12 -7 ,438 -(114 + 319) ,6 -1 ,6 -1 ,4 + 1 ,8 -2 ,6,8 -4 ,4,472 -(170 + 295) ,7 + 0 ,5 + 0 ,5,0 + 0 ,0,1 + 0 },attribute={"str","str","str","str","str","str","str","str","str","int","int","int","int","int","int","int","int","int","dex","dex","dex","dex","dex","dex","int","dex","int","int","int","int","dex","int","dex","int","dex","int","int","int","int","int","str","str"}};RunesBase={type={"R","R","R","R","T","T","T","T","A","A","A","A","E","E","E","E","D","D","D","D","M","M","M","M","Ff","Ef","It","Ic","E"},value={0.5 -0 ,772 -(720 + 51) ,1777.5 -(421 + 1355) ,2 -0 ,1,2,4 -1 ,443 -(397 + 42) ,0.5,1,1.5 -0 ,3 -1 ,190.1 -(23 + 167) ,0.2 + 0 ,0.3 + 0 ,848.4 -(40 + 808) ,0.5 + 0 ,1,1.5 + 0 ,2, -(576 -(47 + 524)), -(27 -17), -15, -(29 -9),0,0 -0 ,1726 -(1165 + 561) ,0 -0 , -(0.1 + 0)},mana={2 + 3 ,10,48 -33 ,901 -(581 + 300) ,11 -6 ,1245 -(1030 + 205) ,14 + 1 ,306 -(156 + 130) ,22 -12 ,10,20 -10 ,6 + 4 ,10,49 -39 ,10,8 + 2 ,2 + 3 ,1955 -(1036 + 909) ,25 -10 ,20, -(180 -(135 + 40)), -10, -(10 + 5), -(44 -24),5,181 -(50 + 126) ,3 + 7 ,20,969 -(522 + 447) },complexity={3 + 2 ,10,7 + 8 ,20,19 -14 ,1 + 9 ,518 -(74 + 429) ,20,5,10,34 -19 ,15 + 5 ,12 -7 ,788 -(454 + 324) ,32 -(12 + 5) ,20,12 -7 ,4 + 6 ,63 -48 ,20,5,985 -(815 + 160) ,64 -49 ,5 + 15 ,5,5,1908 -(41 + 1857) ,51 -31 , -(1187 -(229 + 953))},area={1579 -(874 + 705) ,0 + 0 ,0,679 -(642 + 37) ,0 + 0 ,0,0,0 -0 ,0.5 -0 ,1,1.5,807 -(266 + 539) ,0 -0 ,1225 -(636 + 589) ,0,0,0,0 + 0 ,0,0 -0 ,1187 -(1151 + 36) ,0 + 0 ,0 -0 ,1832 -(1552 + 280) ,0 + 0 ,0,0 + 0 ,0 -0 ,0 -0 }};function CalcRunesPower(v179)local v180=0 -0 ;local v181;while true do if (v180==(1 -0)) then return v181;end if (v180==(819 -(599 + 220))) then v181=0 -0 ;for v408=1931 -(1813 + 118) ,6 + 1  do local v409=v179.runeIds:value(v408);if (RunesBase.type[v409]=="E") then v181=v181 + RunesBase.value[v409] ;end end v180=1218 -(841 + 376) ;end end end function CalcRunesMana(v182)local v183=0 -0 ;for v319=0,2 + 5  do local v320=v182.runeIds:value(v319);if (v320>0) then v183=v183 + RunesBase.mana[v320] ;end end return v183;end function CalcRunesArea(v184)local v185=0;local v186;while true do if (v185==(0 -0)) then v186=0;for v410=0,7 do local v411=859 -(464 + 395) ;local v412;while true do if (v411==0) then v412=v184.runeIds:value(v410);if (RunesBase.type[v412]=="A") then v186=v186 + RunesBase.area[v412] ;end break;end end end v185=1;end if (v185==(2 -1)) then return v186;end end end function RecalcSpellPower(v187,v188,v189,v190,v191)local v192=0 + 0 ;local v193;local v194;local v195;local v196;local v197;while true do if (v192==2) then v197=862 -(467 + 370) ;if v190 then if (SpellBase.attribute[v193]=="str") then v197=GetStrength(v188);elseif (SpellBase.attribute[v193]=="dex") then v197=GetDexterity(v188);elseif (SpellBase.attribute[v193]=="int") then v197=GetIntelligence(v188);end end v192=3;end if (v192==(5 -2)) then if (SpellBase.int_mod[v193]=="add") then v189.effect.power=((SpellBase.effect[v193] * (1 + v194)) + v197) -25 ;elseif (SpellBase.int_mod[v193]=="mul") then v189.effect.power=(SpellBase.effect[v193] * (1 + 0 + v194) * v197)/(85 -60) ;end v189.manaCost=SpellBase.mana[v193] + math.max(0 + 0 ,v195) ;v192=4;end if (v192==(8 -4)) then v189.effect.radius=math.sqrt((SpellBase.area[v193] * (1 + v196))/math.pi );if v190 then local v439=0;while true do if (v439==(521 -(150 + 370))) then if (v189.subtypeId==SpellType.Healing) then local v529=0;while true do if ((1282 -(74 + 1208))==v529) then v189.effect.power=v189.effect.power/(2459 -1459) ;if v191 then local v552=0;local v553;while true do if (0==v552) then v553=false;for v555=0 -0 ,5 + 2  do local v556=v189.runeIds:value(v555);if (RunesBase.type[v556]=="It") then v553=true;elseif (RunesBase.type[v556]=="Ic") then v553=false;break;end end v552=391 -(14 + 376) ;end if (v552==(1 -0)) then if v553 then v189.effect.power=math.max(0,(v189.effect.power * 1000) -v9[v187.id] );end break;end end end break;end end end v189.effect.radius=((SpellBase.area[v193]/math.sqrt(math.pi)) * (1 + 0 + v196) * v197)/(22 + 3) ;break;end if (v439==0) then v189.effect.power=v189.effect.power + math.random( -2,2 + 0 ) ;if  not v191 then v189.manaCost=v189.manaCost/(2930 -1930) ;end v439=1;end end end break;end if (v192==1) then v195=CalcRunesMana(v189);v196=CalcRunesArea(v189);v192=2 + 0 ;end if (v192==(78 -(23 + 55))) then v193=v189.subtypeId + 1 ;v194=CalcRunesPower(v189);v192=1;end end end function RecalcSpellActions(v198,v199,v200)local v201=v198:sense(SenseType.Smell).curr;local v202=v199.subtypeId + 1 ;local v203=(2 -1) -(v198:perkModifier(PerkType.Mana) * 0.01) ;local v204=1 + 0 + (v198:perkModifier(PerkType.Spirit) * 0.01) ;local v205=1000 * v199.manaCost * GetManaBonus(v198.intelligence.curr) * v203 ;local v206=((90 + 10) * v3 * v204)/(7 -2) ;local v207=(SpellBase.actions[v202] * (5 + 10))/v198.actions.curr ;local v208=v201 + (v207 * v206) ;if (v200 and (v208<v205)) then local v344=901 -(652 + 249) ;local v345;while true do if (v344==(0 -0)) then v345=(((v205-v208)/v206) * v198.actions.curr)/(1883 -(708 + 1160)) ;v199.actions=SpellBase.actions[v202] + v345 ;break;end end else v199.actions=SpellBase.actions[v202];end end SkillTypeFromSpellSubtype={5 -2 ,1 + 2 ,5 -2 ,1912 -(242 + 1666) ,2 + 2 ,5,5,8 -3 };PerkTypeFromSpellSubtype={7 + 0 ,10 -2 ,9,1233 -(109 + 1114) ,18 -8 ,12,254 -(6 + 236) ,10 + 2 };function DisableItemEnchant(v209,v210,v211)local v212=0 -0 ;local v213;while true do if (v212==(0 -0)) then v213=SpellBase.subtype[v210.spell.subtypeId + (1134 -(1076 + 57)) ];if ((v211>1) or (((v209.autoSkills:value(SkillTypeFromSpellSubtype[v213 + 1 + 0 ]) + v209:perkModifier(PerkTypeFromSpellSubtype[v213 + (690 -(579 + 110)) ]) + v209.intelligence.curr) -(2 + 23))<v210.spell.complexity)) then local v441=0 + 0 ;while true do if (v441==(0 + 0)) then v210.mp= -(408 -(174 + 233));v210.mpMax= -(2 -1);break;end end elseif (v210.mp<(0 -0)) then local v482=0 + 0 ;while true do if (v482==(1174 -(663 + 511))) then v210.mpMax=90.01 + 10 ;v210.mp=100;break;end end end break;end end end ManaFromArmorType={184 -124 ,49 + 31 ,121 -71 ,77 -37 ,20,752 -(478 + 244) ,20};ManaFromWeaponType={146 -106 ,1616 -(655 + 901) ,4 + 16 ,28 + 12 ,80,204 -144 ,123 -43 };function RecalcItemEnchant(v214,v215,v216,v217)if v216 then if v216.spell then local v413=0 -0 ;while true do if (v413==0) then RecalcSpellPower(v214,v215,v216.spell,v217,true);if v214.isPlayer then DisableItemEnchant(v215,v216,OverloadMod(v214,v215));end v413=352 -(285 + 66) ;end if (v413==(2 -1)) then if  not v217 then if (v216.typeId==ItemType.Armor) then v216.mpMax=ManaFromArmorType[v216.prototype.typeId + (1311 -(682 + 628)) ] + 0.01 ;elseif (v216.typeId==ItemType.Weapon) then v216.mpMax=ManaFromWeaponType[v216.prototype.typeId + 1 + 0 ] + (299.01 -(176 + 123)) ;end end if (v216.mpMax>0) then local v520=0 + 0 ;local v521;while true do if (v520==(0 + 0)) then v521=v216.spell.subtypeId;if (v217 and (v6[v214.id]<=0) and ((v521<=SpellType.PoisonFog) or (v521==SpellType.Healing))) then v216.regenRate=v3;else v216.regenRate=(270 -(239 + 30))/(v216.mpMax * (5 + 10)) ;end break;end end end break;end end end end end function RecalcPlayerSpells(v218,v219,v220)local v221=0 + 0 ;while true do if (v221==(0 -0)) then for v414=0 -0 ,322 -(306 + 9)  do local v415=0 -0 ;while true do if (v415==(0 + 0)) then if v218:spell(v414) then local v522=0 + 0 ;while true do if (v522==0) then RecalcSpellPower(v218,v219,v218:spell(v414).spell,v220,false);RecalcSpellActions(v219,v218:spell(v414).spell,v220);break;end end end RecalcItemEnchant(v218,v219,v218:armor(v414),v220);break;end end end for v416=0,3 do local v417=0;while true do if (v417==0) then RecalcItemEnchant(v218,v219,v218:weapon(v416),v220);RecalcItemEnchant(v218,v219,v218:quickItem(v416),v220);break;end end end break;end end end function PlayerOnMap(v222)if v222.isPlayer then local v348=v222.id-1000000000 ;if ((v348<(482 + 518)) or (v348>(2859616 -1859616))) then return true;end return false;else return true;end end function GetUnitArmor(v223,v224,v225)local v226=0;if v223.isPlayer then v226=CalcArmor(v223,v225);else v226=v224:absorbtion(v225).curr;end v9[v223.id]=v226;return v226;end function CalcArmor(v228,v229)local v230=0;local v231;while true do if (v230==1) then return v231;end if (v230==(1375 -(1140 + 235))) then v231=0 + 0 ;for v418=0 + 0 ,6 do if v228:armor(v418) then local v460=0 + 0 ;local v461;while true do if (0==v460) then v461=v228:armor(v418).absorbtions:value(v229);if (v418==ArmorType.Helm) then v461=(v461 * 1)/(62 -(33 + 19)) ;elseif (v418==ArmorType.Plate) then v461=(v461 * (3 + 3))/(29 -19) ;elseif (v418==ArmorType.Leggins) then v461=(v461 * 3)/(5 + 5) ;elseif (v418==ArmorType.Shirt) then v461=(v461 * (11 -5))/(10 + 0) ;elseif (v418==ArmorType.Pants) then v461=(v461 * (692 -(586 + 103)))/(1 + 9) ;elseif (v418==ArmorType.Boots) then v461=(v461 * (9 -6))/(1498 -(1309 + 179)) ;elseif (v418==ArmorType.Gloves) then v461=(v461 * 3)/(18 -8) ;end v460=1 + 0 ;end if ((2 -1)==v460) then v231=v231 + v461 ;break;end end end end v230=1 + 0 ;end end end function RecalcArmor(v232,v233,v234)if v232.isPlayer then return false;end if IsHumanoid(v232) then for v373=0,12 -6  do local v374=0 -0 ;while true do if (v374==0) then v234:absorbtion(v373).curr=609 -(295 + 314) ;v234:absorbtion(v373):addCurr(CalcArmor(v232,v373));break;end end end else local v350=0 -0 ;local v351;while true do if (v350==(1962 -(1300 + 662))) then for v463=0 -0 ,1760 -(1178 + 577)  do local v464=0;local v465;local v466;while true do if (v464==(0 + 0)) then v465=v234:absorbtion(DamageType.General).curr;v466=0 -0 ;v464=1406 -(851 + 554) ;end if (v464==(1 + 0)) then if (v465~=(0 -0)) then v466=(v234:absorbtion(v463).curr/v465) -(1 -0) ;end v234:absorbtion(v463).curr=math.max(302 -(115 + 187) ,v465 + (v466 * (77 + 23)) );break;end end end v234:absorbtion(DamageType.General).curr=math.max(0,v234:absorbtion(DamageType.General).curr);v350=1 + 0 ;end if ((7 -5)==v350) then if (v234.mp.regen==1) then v234:absorbtion(DamageType.Crushing).curr=v234:absorbtion(DamageType.Crushing).curr-(1181 -(160 + 1001)) ;end break;end if (v350==(1 + 0)) then v351=math.max(0 + 0 ,GetStrength(v233) -(51 -26) );v234:absorbtion(DamageType.Crushing).curr=v234:absorbtion(DamageType.Crushing).curr-v351 ;v350=360 -(237 + 121) ;end end end end function IsHumanoid(v235)if v235.isPlayer then return true;end for v321=0,903 -(525 + 372)  do if v235:armor(v321) then return true;end end return false;end function IsMage(v236)if v236.isPlayer then return false;end for v322=0 -0 ,7 do if v236:spell(v322) then if ((v236:spell(v322).spell.subtypeId<=SpellType.PoisonFog) or (v236:spell(v322).spell.subtypeId>=SpellType.RickMagic)) then return true;end end end return false;end function GetMaxComplexity(v237)local v238=0 -0 ;local v239;while true do if (v238==(143 -(96 + 46))) then return v239;end if (v238==0) then v239=777 -(643 + 134) ;for v419=0 + 0 ,16 -9  do if v237:spell(v419) then v239=math.max(v239,v237:spell(v419).spell.complexity);end end v238=1;end end end function RecalcActions(v240,v241,v242,v243)local v244=0 -0 ;local v245;local v246;local v247;local v248;local v249;local v250;local v251;local v252;while true do if (v244==(1 + 0)) then v247=1 -0 ;if v10[v240.id] then v247=v10[v240.id][1 -0 ];else v247=v246;end v248=GetMaxComplexity(v240);v249=math.max(719 -(316 + 403) ,v243:value(SpellType.Speed) -math.max(v247,v246,v248) );v244=2 + 0 ;end if (v244==(5 -3)) then v250=math.max(0 + 0 ,v243:value(SpellType.Slow) -math.max(v247,v246,v248) );v251=(v249-v250)/(25 -15) ;if (v251<(0 + 0)) then v251=(1 + 0)/((3 -2) -v251) ;else v251=1 + v251 ;end v252=(4 -3) + (v241:perkModifier(PerkType.Quickness)/(207 -107)) ;v244=1 + 2 ;end if (v244==(0 -0)) then v241.actionsDamageModifier=RecalcDamageModifier(v241,BodyPartType.Hand);v245=0.3 + 0 ;v241.actions.base=15 + (v245 * (GetDexterity(v241) -(73 -48))) ;v246=GetUnitArmor(v240,v242,DamageType.General);v244=18 -(12 + 5) ;end if (v244==(11 -8)) then v241.actions.curr=math.max(1 -0 ,v241.actions.base * v252 * v251 * v241.actionsDamageModifier );break;end end end function RecalcBackstab(v253,v254)local v255=0 -0 ;local v256;local v257;while true do if ((0 -0)==v255) then v256=v253.perks:value(PerkType.Backstab);if (v256==0) then return false;end v255=1;end if (v255==(1 + 0)) then v257=1985 -(1656 + 317) ;if ((v256<=(3 + 0)) and v254) then v253.perks:set(PerkType.Backstab,v256 + v257 );elseif ((v256>3) and  not v254) then v253.perks:set(PerkType.Backstab,v256-v257 );end break;end end end function RecalcVitality(v258,v259)local v260=0 + 0 ;local v261;local v262;while true do if (v260==0) then v261=v258.perks:value(PerkType.Vitality);if (v261==(0 -0)) then return false;end v260=1;end if (v260==1) then v262=132 -105 ;if ((v261<=(357 -(5 + 349))) and v259) then v258.perks:set(PerkType.Vitality,v261 + v262 );elseif ((v261>(14 -11)) and  not v259) then v258.perks:set(PerkType.Vitality,v261-v262 );end break;end end end function RecalcMana(v263,v264)local v265=0;local v266;local v267;while true do if (v265==(1271 -(266 + 1005))) then v266=v263.perks:value(PerkType.Mana);if (v266==(0 + 0)) then return false;end v265=1;end if ((3 -2)==v265) then v267=42 -9 ;if ((v266<=(1699 -(561 + 1135))) and v264) then v263.perks:set(PerkType.Mana,v266 + v267 );elseif ((v266>3) and  not v264) then v263.perks:set(PerkType.Mana,v266-v267 );end break;end end end function ApplySpellEffects(v268,v269,v270,v271)local v272=v271;local v273=GetUnitArmor(v268,v270,DamageType.General);local v274=math.max(0 -0 ,v272:value(SpellType.Antimagic) -v273 );local v275=math.max(v274,v272:value(SpellType.ProtFire) -v273 );local v276=math.max(v274,v272:value(SpellType.ProtElectric) -v273 );local v277=math.max(v274,v272:value(SpellType.ProtAcid) -v273 );v270:absorbtion(DamageType.Termical):addCurr(v275);v270:absorbtion(DamageType.Electrical):addCurr(v276);v270:absorbtion(DamageType.Chemical):addCurr(v277);local v278=math.max(0 -0 ,v272:value(SpellType.Invisibility) -v273 )/100 ;v269:percept(SenseType.Sight).curr=math.max(1066 -(507 + 559) ,v269:percept(SenseType.Sight).curr-v278 );v269:percept(SenseType.Hearing).curr=math.max(0 -0 ,v269:percept(SenseType.Hearing).curr-v272:value(SpellType.Silence) );local v281=math.max(0,v272:value(SpellType.Lichdom) -v273 )/(309 -209) ;v269:percept(SenseType.SenseLife).curr=math.max(0,v269:percept(SenseType.SenseLife).curr-v281 );end function ApplyCustomEffects(v283,v284,v285,v286,v287)local v288=0;local v289;while true do if (v288==3) then if IsHumanoid(v283) then local v445=0;local v446;local v447;while true do if (v445==0) then v446=GetStrength(v284)/(413 -(212 + 176)) ;v447=v284:perkModifier(PerkType.Health) * 0.01 ;if (v447>(905 -(250 + 655))) then v447=(2 -1) -v447 ;end v445=1 -0 ;end if (v445==1) then v284:hitLocation(HitLocationType.Head).hpWeight=(1.5 -0) + v447 ;v284:hitLocation(HitLocationType.Left_hand).vitality=0.334 * v446 ;v284:hitLocation(HitLocationType.Left_hand).hpWeight=1 * v446 ;v445=2;end if (v445==2) then v284:hitLocation(HitLocationType.Right_hand).vitality=(1956.334 -(1869 + 87)) * v446 ;v284:hitLocation(HitLocationType.Right_hand).hpWeight=1 * v446 ;v284:hitLocation(HitLocationType.Left_leg).vitality=0.667 * v446 ;v445=10 -7 ;end if (v445==3) then v284:hitLocation(HitLocationType.Left_leg).hpWeight=(1903 -(484 + 1417)) * v446 ;v284:hitLocation(HitLocationType.Right_leg).vitality=(0.667 -0) * v446 ;v284:hitLocation(HitLocationType.Right_leg).hpWeight=(2 -0) * v446 ;break;end end end if v283.currWeapon then v10[v283.id]={v283.currWeapon.damageMin,v283.currWeapon.damageMax};v11[v283.id]=v283.currWeapon.actions;end break;end if (v288==2) then if v283.currWeapon then for v467=0 -0 ,4 + 2  do v284.nawAttacks:set(v467,v283.currWeapon.prototype.damageDistributions:value(v467));end end if (v10[v283.id]==nil) then local v451=0;local v452;while true do if ((0 -0)==v451) then v452=GetUnitArmor(v283,v285,DamageType.General);v10[v283.id]={v452,v452};break;end end end v288=1 + 2 ;end if (v288==0) then v289=PlayerOnMap(v283);if (v285.hp.curr<=0) then v289=false;end v288=1;end if (v288==1) then RecalcPlayerSpells(v283,v284,v289);if v283.isPlayer then RecalcBackstab(v284,v289);RecalcVitality(v284,v289);RecalcMana(v284,v289);end v288=2;end end end function RecalcUnitStats(v290,v291,v292,v293)local v294=0;local v295;local v296;local v297;local v298;local v299;while true do if (v294==3) then if  not v297.isPlayer then local v453=853 -(152 + 701) ;while true do if (v453==(1311 -(430 + 881))) then v295.strength.base=v295.autoSkills:value(AutoSkillType.Archery);v295.dexterity.base=v295.manualSkills:value(ManualSkillType.Stealing);v453=1;end if (1==v453) then v295.intelligence.base=v295.manualSkills:value(ManualSkillType.Tame);break;end end end if v297.isPlayer then for v468=0 + 0 ,898 -(557 + 338)  do if (v297:weapon(v468) and (v297:weapon(v468).durability<(0 + 0))) then v297:weapon(v468).durability=0 -0 ;end end end v296.hp.max=GetModifiedHealth(v290,v292,v296.hp.max);v295:distributeHp(v296.hp.max);v294=13 -9 ;end if ((4 -2)==v294) then ApplySpellEffects(v297,v295,v296,v298);ApplyCustomEffects(v297,v295,v296,v298,v291);RecalcSight(v297,v295);RecalcArmor(v297,v295,v296);v294=6 -3 ;end if (v294==(805 -(499 + 302))) then if v297.isPlayer then v295.maxEncumbrance=GetMaxEncumbrance(v295);else v295.maxEncumbrance=1000866 -(39 + 827) ;end v295.currEncumbrance=v297.itemsWeight;v295:percept(SenseType.Hearing).curr=math.max(2 -1 ,v295.currEncumbrance/300 );if v297.isPlayer then end v294=5;end if (v294==(0 -0)) then v295=UnitServerStats(v290);v296=UnitServerCommonStats(v291);v297=UnitServer(v292);v298=Array(v293,Memory.Type.Float,40,true);v294=3 -2 ;end if (v294==(8 -2)) then if (v297.isPlayer and  not PlayerOnMap(v297)) then v295.move.curr=100;end v296.hp.curr=v295:collectHp(v296.hp.max);if v299 then v295:heal(v291,9 + 91 );end break;end if ((2 -1)==v294) then if (v6[v297.id]==nil) then v6[v297.id]=0 + 0 ;end v299=v296.hp.curr==v296.hp.max ;SetDefaultStats(v295,v296);ApplyPerks(v295);v294=2 -0 ;end if (v294==5) then RecalcActions(v297,v295,v296,v298);v295.moveDamageModifier=1;if (v295.locomotion==LocomotionType.Walk) then v295.moveDamageModifier=RecalcDamageModifier(v295,BodyPartType.Leg);end v295.move.curr=v295.move.base * v295.moveDamageModifier ;v294=6;end end end function RecalcInternalHeroStats(v300,v301)local v302=0;local v303;local v304;while true do if ((104 -(103 + 1))==v302) then v303=UnitServerStats(v300);v303.strength.curr=v303.strength.base;v303.dexterity.curr=v303.dexterity.base;v302=555 -(475 + 79) ;end if (v302==(4 -2)) then v303:distributeHp(CalcBaseHealth(v300));v303.currEncumbrance=v301;v303.maxEncumbrance=GetMaxEncumbrance(v303);v302=9 -6 ;end if ((1 + 2)==v302) then v303.moveDamageModifier=RecalcDamageModifier(v303,BodyPartType.Leg);v303.move.curr=v303.move.base * v303.moveDamageModifier ;v303.actionsDamageModifier=RecalcDamageModifier(v303,BodyPartType.Hand);v302=4;end if (v302==(4 + 0)) then v303.actions.base=10 + (v303.dexterity.curr * 0.2) ;v304=(1504 -(1395 + 108)) + (v303:perkModifier(PerkType.Quickness)/(291 -191)) ;v303.actions.curr=math.max(1205 -(7 + 1197) ,v303.actions.base * v303.actionsDamageModifier * v304 );break;end if (v302==(1 + 0)) then v303.intelligence.curr=v303.intelligence.base;for v420=0,2 + 1  do local v421=319 -(27 + 292) ;while true do if (v421==0) then v303:sense(v420).curr=v303:sense(v420).base;v303:percept(v420).curr=v303:percept(v420).base;break;end end end ApplyPerks(v303);v302=5 -3 ;end end end function GetExpMultiplier(v305)return 2^((v305-(31 -6))/10) ;end function RecalcShopsPriceMultipliers(v306,v307)local v308=0 -0 ;local v309;local v310;local v311;while true do if (v308==0) then v309=(v307 and (7 -3)) or 5 ;v310=16 -7 ;v308=1;end if ((140 -(43 + 96))==v308) then v311=Array(v306,Memory.Type.Float,v309 * v310 ,false);for v422=0,3 do local v423=0;while true do if (v423==(4 -3)) then v311:set((v422 * v310) + (17 -9) ,0.5 + 0 );break;end if (v423==0) then v311:set((v422 * v310) + 1 + 2 ,0 -0 );v311:set((v422 * v310) + 3 + 4 ,0 -0 );v423=1;end end end break;end end end